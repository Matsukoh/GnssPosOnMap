<!DOCTYPE html>
<html>
  <head>
    <title>Map with measured pos by GNSS</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <input type="file" name="file" id="file">
    <div id="result"></div>
    <div id="map"></div>
    <script>
      
      var statLatLngArray;
      var file = document.getElementById('file');
      var result = document.getElementById('result');
      
      // Check the browser can use File API or not
      if(window.File && window.FileReader && window.FileList && window.Blob) {
          function loadLocalCsv(e) {
              // Get file data
              var fileData = e.target.files[0];
      
              // Reject non-CSV
              if(!fileData.name.match('.csv$')) {
                  alert('Please Select CSV File');
                  return;
              }
      
              // Read file object via FileReader
              var reader = new FileReader();
              // Process after achieving to read file
              reader.onload = function() {
                  var cols = reader.result.split('\n');
                  var data = [];
                  for (var i = 0; i < cols.length; i++) {
                      data[i] = cols[i].split(',');
                  }
                  console.log(data.slice(1)[0]);
                  statLatLngArray = data.slice(1);
                  updateMap();
              }
              // ファイル読み込みを実行
              reader.readAsText(fileData);
          }
          file.addEventListener('change', loadLocalCsv, false);
      
      } else {
          file.style.display = 'none';
          result.innerHTML = 'Please use an appropriate browser for File API';
      }
      var map;
      function initMap() {}

      function updateMap() {
        var marker = [];
      console.log(statLatLngArray[0][1]);
      var cnt = markerLatLng = new google.maps.LatLng(statLatLngArray[0][1], statLatLngArray[0][2]);
        map = new google.maps.Map(document.getElementById('map'), {
          center: cnt,
          zoom: 15
        });

      
        for (var i = 0; i < statLatLngArray.length; i++) {
        
          markerLatLng = new google.maps.LatLng(statLatLngArray[i][1], statLatLngArray[i][2]);
          if (statLatLngArray[i][0] == 1) {
            var icon_url = './markers/marker_blue.png';
          } else if (statLatLngArray[i][0] == 0) {
            var icon_url = './markers/marker_green.png';
          } else {
            var icon_url = './markers/marker_red.png';
          }
      
          marker[i] = new google.maps.Marker({
          position: markerLatLng, 
          icon: icon_url,
          map: map 
         });
        }
      }
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=APIKEY&callback=initMap"
    async defer></script>
  </body>
</html>